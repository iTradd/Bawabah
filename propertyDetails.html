<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>*A'5JD 'D9B'1</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #F9FAFB;
            direction: rtl;
            margin: 0;
            padding: 0;
            color: #333;
        }

        header {
            background: linear-gradient(90deg, #F96E2A, #FB8C3E);
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .property-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .property-image {
            flex: 1;
            max-width: 400px;
            text-align: center;
        }

        .property-image img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .property-details {
            flex: 2;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .property-details h1 {
            color: #F96E2A;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .property-details p {
            font-size: 16px;
            margin: 5px 0;
            color: #555;
        }

        .property-details p strong {
            color: #141414;
        }

        .property-details a {
            color: #007BFF;
            text-decoration: none;
            font-weight: bold;
        }

        .property-details a:hover {
            text-decoration: underline;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .action-buttons button {
            background-color: #F96E2A;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .action-buttons button:hover {
            background-color: #141414;
            transform: scale(1.05);
        }
        
.modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    background-color: rgba(0, 0, 0, 0.5);
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.modal-header h2 {
    margin: 0;
    color: #F96E2A;
}

.modal-header button {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #F96E2A;
}

.modal-content {
    background: white;
    padding: 20px;
    border-radius: 10px;
    width: 500px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    max-height: 90vh; /* *-/J/ #B5I '1*A'9 DDF'A0) */
    overflow: hidden; /* %.A'! 'D*E1J1 AJ 'D(/'J) */
    display: flex;
    flex-direction: column;
}

.modal-body {
    flex-grow: 1; /* J,9D 'DE-*HI J*E// */
    overflow-y: auto; /* 'D3E'- ('D*E1J1 'D9EH/J */
    max-height: calc(90vh - 60px); /* *.5J5 '1*A'9 DD*E1J1 /'.D 'DF'A0) */
    padding-right: 10px; /* D*A'/J 'D*5'B 'DF5 (41J7 'D*E1J1 */
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

label {
    font-size: 14px;
    font-weight: bold;
}

input,
textarea,
select {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
    width: 100%;
    box-sizing: border-box;
}

textarea {
    resize: none;
    height: 80px;
}

button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    background: #F96E2A;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
}

button:hover {
    background: #FB8C3E;
    transform: scale(1.05);
}

        
    </style>
</head>
<body>
    <header>*A'5JD 'D9B'1</header>
    <div class="property-container" id="propertyDetails">
        <!-- 3J*E 916 *A'5JD 'D9B'1 GF' -->
    </div>

    <script>
        const apiUrl = 'https://script.google.com/macros/s/AKfycbw2MNBeXvZGvkdwh6DCS9-BhMEkaGZNuqHjihxth_TZaYPH16GtZNjpRiLJoGdEN00/exec';

    function fetchPropertyDetails(propertyId) {
    console.log('Fetching property details for ID:', propertyId);
    fetch(`${apiUrl}?action=getPropertyDetails&sheet=Real_Estate&propertyId=${propertyId}`)
        .then(response => {
            console.log('Response received:', response);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(property => {
            console.log('Property details:', property);
            renderPropertyDetails(property);
        })
        .catch(error => {
            console.error('Error fetching property details:', error);
            document.getElementById('propertyDetails').innerHTML = '<p>-/+ .7# #+F'! ,D( 'D(J'F'*.</p>';
        });
}



       function renderPropertyDetails(property) {
  const container = document.getElementById('propertyDetails');
  container.innerHTML = `
    <div class="property-image">
      <img src="${property.'D5H1}" alt="${property.'3E_'D9B'1}">
    </div>
    <div class="property-details">
      <h1>${property.'3E_'D9B'1}</h1>
      <p><strong>1BE 'D%9D'F:</strong> ${property.E91A_'D9B'1}</p>
      <p><strong>FH9 'D9B'1:</strong> ${property.FH9_'D9B'1}</p>
      <p><strong>'DEHB9:</strong> ${property.'DEHB9}</p>
      <p><a href="${property.1'(7_'DEHB9}" target="_blank">916 9DI 'D.1J7)</a></p>
      <p><strong>'DH5A:</strong> ${property.'DH5A}</p>
      <p><strong>'DE3'-):</strong> ${property.'DE3'-)} E²</p>
      <p><strong>916 'D4'19:</strong> ${property.916_'D4'19} E*1</p>
      <p><strong>'DH',G):</strong> ${property.'DH',G)}</p>
      <p><strong>'D-'D):</strong> ${property.'D-'D)}</p> <!-- 916 'D-'D) CF5 -->
                    ${generateDynamicDetails(property)}
                    <div class="action-buttons">
                        <button onclick="editProperty(${property.E91A_'D9B'1})">*9/JD</button>
                        <button onclick="deleteProperty(${property.E91A_'D9B'1})">-0A</button>
                        <button onclick="archiveProperty(${property.E91A_'D9B'1})">#14A)</button>
                    </div>
                </div>
            `;
        }

function generateDynamicDetails(property) {
    if (property.FH9_'D9B'1 === 'AD)' || property.FH9_'D9B'1 === '4B)' || property.FH9_'D9B'1 === '/H1' || property.FH9_'D9B'1 === '4'DJG') {
        return `
            <p><strong>9// 'D:1A:</strong> ${property.9//_'D:1A}</p>
            <p><strong>9// 'D-E'E'*:</strong> ${property.9//_'D-E'E'*}</p>
        `;
    } else if (property.FH9_'D9B'1 === '#16' || property.FH9_'D9B'1 === 'E219)') {
        return `
            <p><strong>'3*./'E 'D9B'1:</strong> ${property.'3*./'E_'D9B'1}</p>
            <p><strong>9// 'D4H'19 'DE-J7):</strong> ${property.9//_'D4H'19_'DE-J7)}</p>
        `;
    } else if (property.FH9_'D9B'1 === 'E-D') {
        return `
            <p><strong>E3'-) 'DE-D:</strong> ${property.E3'-)_'DE-D} E²</p>
            <p><strong>9// 'DA*-'*:</strong> ${property.9//_'DA*-'*}</p>
        `;
    }
    return '';
}


 let currentProperty = null; // *91JA 'DE*:J1 9DI E3*HI 'DCH/

function editProperty(propertyId) {
    fetch(`${apiUrl}?action=getPropertyDetails&sheet=Real_Estate&propertyId=${propertyId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch property details');
            }
            return response.json();
        })
        .then(property => {
            currentProperty = property; // *-/J+ 'DE*:J1 ((J'F'* 'D9B'1 'D-'DJ)

            // *9(&) 'D-BHD AJ 'DFEH0,
            document.getElementById('editName').value = property.'3E_'D9B'1 || '';
            document.getElementById('editType').value = property.FH9_'D9B'1 || '';
            document.getElementById('editLocation').value = property.'DEHB9 || '';
            document.getElementById('editMapLink').value = property.1'(7_'DEHB9 || '';
            document.getElementById('editDescription').value = property.'DH5A || '';
            document.getElementById('editStreetWidth').value = property.916_'D4'19 || '';
            document.getElementById('editFacade').value = property.'DH',G) || '';

            // *-/J+ 'D-BHD 'D/JF'EJCJ) (F'!K 9DI FH9 'D9B'1
            updateFieldsBasedOnType(property.FH9_'D9B'1);

            if (['4B)', 'AD)', '/H1', '4'DJG'].includes(property.FH9_'D9B'1)) {
                document.getElementById('editRooms').value = property.9//_'D:1A || 0;
                document.getElementById('editBathrooms').value = property.9//_'D-E'E'* || 0;
            } else if (['#16', 'E219)'].includes(property.FH9_'D9B'1)) {
                document.getElementById('editUsage').value = property.'3*./'E_'D9B'1 || '';
                document.getElementById('editStreets').value = property.9//_'D4H'19_'DE-J7) || 0;
            } else if (property.FH9_'D9B'1 === 'E-D') {
                document.getElementById('editArea').value = property.E3'-)_'DE-D || 0;
                document.getElementById('editOpenings').value = property.9//_'DA*-'* || 0;
            }

            // 916 F'A0) 'D*9/JD
            document.getElementById('editModal').style.display = 'block';
        })
        .catch(error => {
            console.error('Error fetching property details:', error);
            alert('-/+ .7# #+F'! ,D( (J'F'* 'D9B'1.');
        });
}

        function updateFieldsBasedOnType() {
    const type = document.getElementById('editType').value;
    const dynamicFields = document.getElementById('dynamicFields');
    dynamicFields.innerHTML = ''; // E3- 'D-BHD 'D-'DJ)

    if (['4B)', 'AD)', '/H1', '4'DJG'].includes(type)) {
        dynamicFields.innerHTML = `
            <label>9// 'D:1A:</label>
            <input type="number" id="editRooms" min="0">
            <label>9// 'D-E'E'*:</label>
            <input type="number" id="editBathrooms" min="0">
        `;
    } else if (['#16', 'E219)'].includes(type)) {
        dynamicFields.innerHTML = `
            <label>'3*./'E 'D9B'1:</label>
            <input type="text" id="editUsage">
            <label>9// 'D4H'19 'DE-J7):</label>
            <input type="number" id="editStreets" min="0">
        `;
    } else if (type === 'E-D') {
        dynamicFields.innerHTML = `
            <label>E3'-) 'DE-D:</label>
            <input type="number" id="editArea" min="0">
            <label>9// 'DA*-'*:</label>
            <input type="number" id="editOpenings" min="0">
        `;
    }
}

function saveChanges() {
    if (!currentProperty) {
        alert('DE J*E *-EJD (J'F'* 'D9B'1 (4CD 5-J-.');
        return;
    }

    const updatedProperty = {
        E91A_'D9B'1: currentProperty.E91A_'D9B'1, // '3*./'E E91A 'D9B'1 D*-/J/ 'D5A
        '3E_'D9B'1: document.getElementById('editName').value,
        FH9_'D9B'1: document.getElementById('editType').value,
        'DEHB9: document.getElementById('editLocation').value,
        1'(7_'DEHB9: document.getElementById('editMapLink').value,
        'DH5A: document.getElementById('editDescription').value,
        916_'D4'19: document.getElementById('editStreetWidth').value,
        'DH',G): document.getElementById('editFacade').value,
    };

    const type = updatedProperty.FH9_'D9B'1;

    // %6'A) 'D-BHD 'D/JF'EJCJ) (F'!K 9DI FH9 'D9B'1
    if (['4B)', 'AD)', '/H1', '4'DJG'].includes(type)) {
        updatedProperty.9//_'D:1A = document.getElementById('editRooms').value;
        updatedProperty.9//_'D-E'E'* = document.getElementById('editBathrooms').value;
    } else if (['#16', 'E219)'].includes(type)) {
        updatedProperty.'3*./'E_'D9B'1 = document.getElementById('editUsage').value;
        updatedProperty.9//_'D4H'19_'DE-J7) = document.getElementById('editStreets').value;
    } else if (type === 'E-D') {
        updatedProperty.E3'-)_'DE-D = document.getElementById('editArea').value;
        updatedProperty.9//_'DA*-'* = document.getElementById('editOpenings').value;
    }

    console.log("Data to send:", updatedProperty); // *3,JD 'D(J'F'* 'DE13D)

    // %13'D 'D(J'F'* %DI 'D.'/E
    fetch(`${apiUrl}?action=updateProperty&sheet=Real_Estate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedProperty),
    })
       .then(response => {
    console.log('Server Response:', response); // 3,D '3*,'() 'D.'/E
    if (!response.ok) {
        throw new Error('Failed to update property');
    }
    return response.text();
})
        .then(result => {
            alert('*E -A8 'D*9/JD'* (F,'-');
            closeModal(); // %:D'B 'DF'A0)
        })
      .catch(error => {
    console.error('Error saving changes:', error); // 3,D *A'5JD 'D.7#
    alert('-/+ .7# #+F'! -A8 'D*9/JD'*.');
});
}

function closeModal() {
    document.getElementById('editModal').style.display = 'none';
}

        
        
function deleteProperty(propertyId) {
    if (confirm("GD #F* E*#C/ EF -0A G0' 'D9B'1")) {
        fetch(`${apiUrl}?action=delete&sheet=Real_Estate&propertyId=${propertyId}`, { 
            method: 'POST' 
        })
        .then(response => response.text())
        .then(result => {
            alert(result); // 916 'DF*J,) DDE3*./E
            window.location.href = 'index.html'; // %9'/) 'D*H,JG DD5A-) 'D1&J3J)
        })
        .catch(error => {
            console.error('Error deleting property:', error);
            alert('-/+ .7# #+F'! 'D-0A.');
        });
    }
}


function archiveProperty(propertyId) {
    if (confirm("GD #F* E*#C/ EF #14A) G0' 'D9B'1")) {
        fetch(`${apiUrl}?action=archive&sheet=Real_Estate&propertyId=${propertyId}`, { 
            method: 'POST' 
        })
        .then(response => response.text())
        .then(result => {
            alert(result); // 916 'DF*J,) DDE3*./E
            window.location.href = 'index.html'; // %9'/) 'D*H,JG DD5A-) 'D1&J3J)
        })
        .catch(error => {
            console.error('Error archiving property:', error);
            alert('-/+ .7# #+F'! 'D#14A).');
        });
    }
}


        const urlParams = new URLSearchParams(window.location.search);
const propertyId = urlParams.get('propertyId');
console.log('Property ID:', propertyId); // *-BB EE' %0' C'F E91QA 'D9B'1 J8G1 GF'
if (propertyId) {
    fetchPropertyDetails(propertyId);
} else {
    document.getElementById('propertyDetails').innerHTML = '<p>E91A 'D9B'1 :J1 E*HA1.</p>';
}
    </script>
<div class="modal" id="editModal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>*9/JD 'D9B'1</h2>
            <button onclick="closeModal()">%:D'B</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>'3E 'D9B'1:</label>
                <input type="text" id="editName">
            </div>
            <div class="form-group">
                <label>FH9 'D9B'1:</label>
                <select id="editType" onchange="updateFieldsBasedOnType()">
                    <option value="4B)">4B)</option>
                    <option value="AD)">AD)</option>
                    <option value="/H1">/H1</option>
                    <option value="4'DJG">4'DJG</option>
                    <option value="#16">#16</option>
                    <option value="E219)">E219)</option>
                    <option value="E-D">E-D</option>
                </select>
            </div>
            <div class="form-group">
                <label>'DEHB9:</label>
                <input type="text" id="editLocation">
            </div>
            <div class="form-group">
                <label>1'(7 'DEHB9 9DI 'D.1J7):</label>
                <input type="text" id="editMapLink">
            </div>
            <div class="form-group">
                <label>'DH5A:</label>
                <textarea id="editDescription"></textarea>
            </div>
            <div class="form-group">
                <label>916 'D4'19:</label>
                <input type="text" id="editStreetWidth">
            </div>
            <div class="form-group">
                <label>'DH',G):</label>
                <input type="text" id="editFacade">
            </div>
            <div id="dynamicFields" class="form-group">
                <!-- 3J*E *HDJ/ 'D-BHD 'D/JF'EJCJ) GF' (F'!K 9DI FH9 'D9B'1 -->
            </div>
            <div class="form-group">
                <label>'DE1AB'* 'D-'DJ):</label>
                <div id="currentAttachments"></div>
            </div>
            <div class="form-group">
                <label>%6'A) E1AB'* ,/J/):</label>
                <input type="file" id="newAttachments" multiple>
                <div id="uploadStatus"></div>
            </div>
        </div>
        <div class="form-group">
            <button onclick="saveChanges()">-A8</button>
        </div>
    </div>
</div>


</body>
</html>
